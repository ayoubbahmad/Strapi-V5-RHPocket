import{aX as N,a8 as O,o as G,K as U,e9 as k,ec as Q,e6 as Y,a as R,p as e,x as d,V as q,aA as H,gt as K,gu as X,c7 as m,ex as j,G as c,gv as _,gw as $,m as J,bU as W,a9 as Z,e4 as ee,F as I,B as te,eO as se,e3 as ae}from"./strapi-Ddy60Q00.js";import{a as ne,f as ie,t as re,g as P}from"./Field-DufHXW17-CxqjAf5E.js";import"./Relations-BTcf5xaw-Bj4YC1B1.js";import"./useDragAndDrop-DdHgKsqq-BL0loorR.js";import"./relations-C0w0GcXi-DJ9hxzkR.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-B42WZUoE.js";import"./objects-mKMAmfec-BwwVA-bm.js";import"./useDebounce-DmuSJIF3-HjGX59KU.js";const oe=a=>R.useEffect(a,de),de=[],S=({layout:a})=>e.jsx(I,{direction:"column",alignItems:"stretch",gap:6,children:a.map((n,o)=>{if(n.some(s=>s.some(t=>t.type==="dynamiczone"))){const[s]=n,[t]=s;return e.jsx(c.Root,{gap:4,children:e.jsx(c.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(P,{...t})})},t.name)}return e.jsx(te,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:e.jsx(I,{direction:"column",alignItems:"stretch",gap:6,children:n.map((s,t)=>e.jsx(c.Root,{gap:4,children:s.map(({size:r,...u})=>e.jsx(c.Item,{col:r,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(P,{...u})},u.name))},t))})},o)})}),ce=()=>{const a=N(),[{query:{status:n}},o]=O({status:"draft"}),{formatMessage:s}=G(),{toggleNotification:t}=U(),{document:r,meta:u,isLoading:T,schema:l,components:g,collectionType:v,id:C,model:D,hasError:A}=k(),h=l?.options?.draftAndPublish??!1;oe(()=>{a?.state&&"error"in a.state&&t({type:"danger",message:a.state.error,timeout:5e3})});const B=Q("EditViewPage",i=>i.isLoading),x=v===se,p=!C&&!x,{isLoading:F,edit:{layout:b,settings:{mainField:f}}}=Y(D),{isLazyLoading:M}=ne([]),w=B||T||F||M,L=R.useMemo(()=>{if(!r&&!p&&!x||!l)return;const i=r?.id?r:ie(l,g);return re(l,g)(i)},[r,p,x,l,g]);if(A)return e.jsx(d.Error,{});if(w&&!r?.documentId)return e.jsx(d.Loading,{});if(!L)return e.jsx(d.Error,{});const V=i=>{(i==="published"||i==="draft")&&o({status:i},"push",!0)},y=f!=="id"&&r?.[f]?r[f]:"Untitled";return e.jsxs(q,{paddingLeft:10,paddingRight:10,children:[e.jsx(d.Title,{children:`${y}`}),e.jsx(H,{disabled:h&&n==="published",initialValues:L,method:p?"POST":"PUT",validate:(i,z)=>K(l?.attributes,g,{status:n,...z}).validate(i,{abortEarly:!1}),children:({resetForm:i})=>e.jsxs(e.Fragment,{children:[e.jsx(X,{isCreating:p,status:h?ue(r,u):void 0,title:y}),e.jsxs(m.Root,{variant:"simple",value:n,onValueChange:V,children:[e.jsx(m.List,{"aria-label":s({id:j("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:h?e.jsxs(e.Fragment,{children:[e.jsx(E,{value:"draft",children:s({id:j("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(E,{disabled:!u||u.availableStatus.length===0,value:"published",children:s({id:j("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(c.Root,{paddingTop:8,gap:4,children:[e.jsxs(c.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(m.Content,{value:"draft",children:e.jsx(S,{layout:b})}),e.jsx(m.Content,{value:"published",children:e.jsx(S,{layout:b})})]}),e.jsx(c.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(_,{})})]})]}),e.jsx($,{onProceed:i})]})})]})},E=J(m.Trigger)`
  text-transform: uppercase;
`,ue=(a,n)=>{const o=a?.status,s=n?.availableStatus??[];return o?o==="draft"&&s.find(t=>t.publishedAt!==null)?"published":o:"draft"},ye=()=>{const{slug:a=""}=W(),{permissions:n=[],isLoading:o,error:s}=Z(ae.map(t=>({action:t,subject:a})));return o?e.jsx(d.Loading,{}):s||!a?e.jsx(d.Error,{}):e.jsx(d.Protect,{permissions:n,children:({permissions:t})=>e.jsx(ee,{permissions:t,children:e.jsx(ce,{})})})};export{ce as EditViewPage,ye as ProtectedEditViewPage};
